(function(){for(var f=0,b=["ms","moz","webkit","o"],h=0;h<b.length&&!window.requestAnimationFrame;++h)window.requestAnimationFrame=window[b[h]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[h]+"CancelAnimationFrame"],window[b[h]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var h=(new Date).getTime(),p=Math.max(0,16-(h-f)),z=window.setTimeout(function(){b(h+p)},p);f=h+p;return z});window.cancelAnimationFrame||(window.cancelAnimationFrame=
function(b){clearTimeout(b)})})();
(function(){function f(c,a,e){this.f=c;this.e=a;this.d=e}function b(c){this.m=c;this.f=g[c].f;this.e=g[c].e;this.d=g[c].d}function h(){requestAnimationFrame(h,k);switch(v){case F:startGame();break;case C:q&&!r&&0<thePlayer.x&&(thePlayer.x-=thePlayer.g,0>thePlayer.x&&(thePlayer.x=0));r&&!q&&thePlayer.x+thePlayer.a<k.width&&(thePlayer.x+=thePlayer.g,thePlayer.x+thePlayer.a>k.width&&(thePlayer.x=k.width-thePlayer.a));A++;if(A===s){var c=Object.create(G);c.y=0-c.b;var a=0,a=3>Math.floor(4*Math.random()+
1)?Math.floor(10*Math.random()):Math.floor(23*Math.random());c.x=a*c.a;a=Math.floor(12*Math.random()*s);32>a&&(a=32);c.a=a;c.n=l;m.push(c);A=0;s>w?s--:s+=30}for(c=0;c<m.length;c++){a=m[c];a.y+=a.n;var e=thePlayer,b=!1,b=e.i()-a.i(),g=e.j()+a.j();if(b=Math.abs(e.h()-a.h())<e.k()+a.k()?Math.abs(b)<g?!0:!1:!1){var e=thePlayer,b="",b=e.h()-a.h(),g=e.i()-a.i(),f=e.k()+a.k(),n=e.j()+a.j();Math.abs(b)<f?Math.abs(g)<n?(f-=Math.abs(b),n-=Math.abs(g),f>=n?0<g?(b="top",e.y+=n):(b="bottom",e.y-=n):0<b?(b="left",
e.x+=f):(b="right",e.x-=f)):b="none":b="none";switch(b){case "top":e=a.x;b=a.a;g=thePlayer.x-e;f=thePlayer.x+thePlayer.a;n=e+b;thePlayer.x<e?thePlayer.a=e-thePlayer.x:f>n?(thePlayer.x=n,thePlayer.a-=b-g):v=D;B();break;case "left":p(a,m);E(a.x,a.a,!1);B();break;case "right":p(a,m),E(a.x,a.a,!0),B()}}a.y>k.height+a.b&&p(a,m)}break;case D:z(),gameOverTimeout=window.setTimeout(H,800)}d.clearRect(0,0,k.width,k.height);thePlayer.y=448;if(!0==q||!0==r)d.fillStyle="rgba("+t.c()+",.2)",!0!=q&&r?!0!=r&&q||
d.fillRect(thePlayer.x-thePlayer.g,thePlayer.y,thePlayer.a+thePlayer.g,32):d.fillRect(thePlayer.x+thePlayer.g,thePlayer.y,thePlayer.a-thePlayer.g,32);d.fillStyle="rgb("+t.c()+")";d.fillRect(thePlayer.x,thePlayer.y,thePlayer.a,32);for(c=0;c<m.length;c++)a=m[c],d.fillStyle="rgba("+x.c()+",.2)",d.fillRect(a.x,a.y-.8*l,a.a,a.b+.8*l),d.fillStyle="rgba("+x.c()+",.1)",d.fillRect(a.x,a.y-1.6*l,a.a,a.b+1.6*l),d.fillRect(a.x,a.y-2.4*l,a.a,a.b+2.4*l),d.fillRect(a.x,a.y-3.2*l,a.a,a.b+3.2*l),d.fillStyle="rgb("+
x.c()+")",d.fillRect(a.x,a.y,a.a,a.b);z()}function E(c,a,b){!0==b?800<c+a&&(a-=c+a-800):thePlayer.x=c;thePlayer.a+=a}function B(){u++;0<u&&0==u%30&&4<w&&(w-=1);0<u&&0==u%30&&(l++,thePlayer.g++,y.next(),x.next(),t.next(),k.style.background="rgb("+y.l()+")")}function p(c,a){var b=a.indexOf(c);-1!==b&&a.splice(b,1)}function z(){d.textBaseline="top";d.fillStyle="rgb("+t.c()+")";d.font="bold 24px monospace";d.fillText(u,8,5);v==F&&(d.fillStyle="rgb("+t.c()+")",d.font="bold 32px monospace",d.fillText("miniwallism",
315,300),d.font="bold 24px monospace",d.fillText("left and right arrow keys to move",190,340));v==D&&(d.fillStyle="rgb("+t.c()+")",d.font="bold 32px monospace",d.fillText("game over",315,300),d.font="bold 24px monospace",d.fillText("press left or right to retry",215,340))}function H(){if(!0==q||!0==r){y=new b(5);x=new b(5);t=new b(2);k.style.background="rgb("+y.l()+")";s=60;w=15;l=5;u=A=0;thePlayer.x=384;thePlayer.a=32;thePlayer.g=6;for(var c=m.length;0<=c;c--)p(m[c],m);v=C}}var k=document.getElementById("canvas"),
d=k.getContext("2d"),G={x:0,y:0,a:32,b:32,n:0,h:function(){return this.x+this.a/2},i:function(){return this.y+this.b/2},k:function(){return this.a/2},j:function(){return this.b/2}},m=[];f.prototype.c=function(){return this.f+","+this.e+","+this.d};f.prototype.l=function(){return Math.floor(this.f/4)+","+Math.floor(this.e/4)+","+Math.floor(this.d/4)};var g=[],I=new f(255,127,30),J=new f(255,255,30),K=new f(30,255,95),L=new f(30,127,255),M=new f(30,30,255),N=new f(127,30,255),O=new f(255,30,127);g.push(new f(255,
30,30));g.push(I);g.push(J);g.push(K);g.push(L);g.push(M);g.push(N);g.push(O);b.prototype.c=function(){return this.f+","+this.e+","+this.d};b.prototype.l=function(){return Math.floor(this.f/4)+","+Math.floor(this.e/4)+","+Math.floor(this.d/4)};b.prototype.next=function(){7>this.m?this.m++:this.m=0;var b=this.m;this.f=g[b].f;this.e=g[b].e;this.d=g[b].d};var y=new b(5),x=new b(5),t=new b(2);k.style.background="rgb("+y.l()+")";var F=0,C=1,D=2,v=C,s=60,w=15,l=5,A=0,u=0,r=!1,q=!1;thePlayer=Object.create({x:384,
y:448,a:32,b:32,g:6,n:0,h:function(){return this.x+this.a/2},i:function(){return this.y+this.b/2},k:function(){return this.a/2},j:function(){return this.b/2}});window.addEventListener("keydown",function(b){switch(b.keyCode){case 37:q=!0;break;case 39:r=!0}},!1);window.addEventListener("keyup",function(b){switch(b.keyCode){case 37:q=!1;break;case 39:r=!1}},!1);h()})();